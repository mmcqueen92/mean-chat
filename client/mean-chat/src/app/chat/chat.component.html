<div class="chat-container" *ngIf="activeChat">
  <div class="chat-header">
    <div *ngIf="this.promoteMembers">
      <h3>
        <ng-container *ngFor="let participant of participants; let last = last">
          {{ participant.name }}
          <button
            *ngIf="!activeChat.admins.includes(participant._id)"
            (click)="promoteToAdmin(participant._id)"
          >
            Promote to Admin
          </button>
          <span *ngIf="!last">, </span>
        </ng-container>
      </h3>
      <button (click)="togglePromoteMembers()">Cancel</button>
    </div>
    <div *ngIf="!this.promoteMembers">
      <h3>
        <ng-container *ngFor="let participant of participants; let last = last">
          {{ participant.name }}
          <span *ngIf="!last">, </span>
          <button
            *ngIf="!participant.inUserContacts"
            (click)="addToContacts(participant.email)"
          >
            Add to Contacts
          </button>
        </ng-container>
      </h3>
    </div>
    <div class="chat-controls" *ngIf="chatControls">
      <button
        *ngIf="activeChat.admins && activeChat.admins.includes(currentUser._id)"
        (click)="togglePromoteMembers()"
        class="action-button"
      >
        Promote Members
      </button>
      <button
        *ngIf="activeChat.name !== 'User-User'"
        (click)="leaveChat()"
        class="action-button warning-button"
      >
        Leave Chat
      </button>
      <button
        *ngIf="activeChat.admins && activeChat.admins.includes(currentUser._id)"
        (click)="deleteChatRoom(activeChat._id)"
        class="action-button danger-button"
      >
        Delete Chatroom
      </button>
    </div>
    <button
      class="action-button settings-button"
      (click)="toggleChatControls()"
    >
      Chat Controls
    </button>
  </div>

  <div class="chat-messages" #chatMessagesContainer>
    <!-- list of chat messages -->
    <div class="message-container" *ngFor="let message of messages">
      <div *ngIf="message.sender._id !== currentUser._id" class="participant-message">
        <div class="message-sender">{{ message.sender.name }}:</div>
        <div class="message-content">{{ message.text }}</div>
      </div>
      <div *ngIf="message.sender._id === currentUser._id" class="user-message">
        <div class="message-sender">{{ message.sender.name }}:</div>
        <div class="message-content">{{ message.text }}</div>
      </div>
    </div>
    <div *ngIf="messages.length === 0" class="no-messages">
      Send a message to get started
    </div>
  </div>

  <div class="chat-input-container">
    <textarea
      type="text"
      rows="4"
      [(ngModel)]="messageText"
      placeholder="Type your message..."
      (keyup.enter)="sendMessage()"
      class="chat-input"
    ></textarea>

    <button (click)="sendMessage()" class="send-button">Send</button>
  </div>
</div>

<div class="chat-container" *ngIf="!activeChat">
  <div class="no-chat-selected">No chat selected</div>
</div>
